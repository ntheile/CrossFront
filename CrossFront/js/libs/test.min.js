var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Templates=function(){function n(){}return n.contact=null,n.editContact=null,n.contacts=null,n}(),AppEvents=function(){function n(){}return n}(),appEvents=new AppEvents;_.extend(appEvents,Backbone.Events);var Contact=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.initialize=function(){console.log("Contact init.")},t.prototype.defaults=function(){return{id:null,firstName:"",lastName:"",email:"",address:"",city:"",state:""}},t.prototype.validate=function(n){return _.isEmpty(n.firstName)?"First name is required.":_.isEmpty(n.lastName)?"Last name is required.":_.isEmpty(n.email)?"Email is required.":n.email.indexOf("@")<1||n.email.indexOf(".")<1?"The email address appears to be invalid.":""},t}(Backbone.Model),Contacts=function(n){function t(t){this.url="/api/Contacts",n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){console.log("Contacts init.")},t}(Backbone.Collection),ContactView=function(n){function t(t){this.tagName="div",n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){var n=this;console.log("Contact view init."),_.bindAll(this,"render");this.model.on("change",this.render);this.model.on("reset",this.render);this.model.on("destroy",function(){$(n.el).remove()})},t.prototype.render=function(){var t,i,n,r;return r=this,t=this.model.toJSON(),i=Templates.contact(t),n=$(this.el).html(i),$(n).find("a").click(function(){appEvents.trigger("selectContact",r.model)}),this.elm=$("#contactDetail"+this.model.get("id")),n},t}(Backbone.View),EditContactView=function(n){function t(t){this.events={"click #btnClear":"clearThis","click #btnAdd":"addThis","click #btnDelete":"deleteThis","click #btnUpdate":"updateThis"},this.tagName="div",this.el=$("#contact"),n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){console.log("Edit contact init."),_.bindAll(this,"render","clearThis","onError","updateModel","updateThis","deleteThis","addThis");appEvents.on("selectContact",this.updateModel);this.model.on("error",this.onError)},t.prototype.updateModel=function(n){this.model=n,this.model.off("error");this.model.on("error",this.onError);this.render()},t.prototype.onError=function(n,t){var i,f,e,r,u;r=t,_.has(t,"statusText")?(r=t.statusText,u="Operation Error."):u="Validation Error.",console.log("On error: "+t),i=$(this.el).find(".alert"),f=$(this.el).find("#alertHeader"),e=$(this.el).find("#alertBody"),i.hide(),f.text(u),e.text(r),i.show("fast")},t.prototype.updateButtons=function(){var n=function(n,t){t?n.removeAttr("disabled"):n.attr("disabled",!0)};n($("#btnAdd"),this.model.get("id")===null),n($("#btnUpdate"),this.model.get("id")!==null),n($("#btnDelete"),this.model.get("id")!==null)},t.prototype.bindForm=function(){this.model.set({id:$(this.el).find("#contactId").val(),firstName:$(this.el).find("#firstName").val(),lastName:$(this.el).find("#lastName").val(),email:$(this.el).find("#email").val()})},t.prototype.render=function(){return console.log("Edit contact render."),$(this.el).html(Templates.editContact(this.model.toJSON())),this.updateButtons(),$(".alert").hide(),$(".close").click(function(){$(".alert").hide("slow")}),this},t.prototype.clearThis=function(){this.updateModel(new Contact),this.render()},t.prototype.addThis=function(){if(this.bindForm(),this.model.isValid()){var n=this.model.toJSON();n.id=null,this.clearThis(),this.trigger("onAdd",n)}},t.prototype.updateThis=function(){this.bindForm(),this.model.isValid()&&(this.model.save(),this.updateButtons())},t.prototype.deleteThis=function(){this.model.destroy(),this.clearThis()},t}(Backbone.View),ContactList=function(n){function t(t){this.tagName="div",this.el=$("#results"),n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){var n;n=this,console.log("ContactList init."),_.bindAll(this,"render");this.collection.on("reset",this.render);Application.editContactView=new EditContactView({model:new Contact}),Application.editContactView.render();Application.editContactView.on("onAdd",function(t){n.collection.create(t,{success:function(){n.collection.fetch()}})})},t.prototype.addItem=function(n){var t,i;t=new ContactView({model:n}),i=t.render(),$(this.el).append(i)},t.prototype.render=function(){console.log("ContactList render.");var n=this;return $(this.el).html(Templates.contacts({})),this.collection.each(function(t){n.addItem(t)}),this},t}(Backbone.View),Application=function(){function n(){var n,t;Templates.contact=_.template($("#contactTemplate").html()),Templates.editContact=_.template($("#editContactTemplate").html()),Templates.contacts=_.template($("#contactsTemplate").html()),n=new Contacts,n.fetch(),t=new ContactList({collection:n}),t.render()}return n.editContactView=null,n}(),App=new Application